<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Chrome 로그인</title>
<style>
body{background:#fafafa;font-family:Roboto,Arial,sans-serif;margin:0;display:flex;align-items:center;justify-content:center;height:100vh;}
.card{background:#fff;padding:24px;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.15);width:90%;max-width:360px;text-align:center;}
h2{font-weight:400;margin-bottom:16px;color:#202124;}
input{width:100%;padding:10px;margin:8px 0;border:1px solid #dadce0;border-radius:4px;font-size:15px;}
button{width:100%;background:#1a73e8;color:#fff;font-weight:500;border:0;padding:10px;border-radius:4px;margin-top:12px;font-size:15px;}
#spin{border:3px solid #eee;border-top:3px solid #1a73e8;border-radius:50%;width:28px;height:28px;animation:spin 0.8s linear infinite;margin:20px auto;display:none;}
@keyframes spin{to{transform:rotate(360deg);}}
#status{color:#5f6368;font-size:13px;margin-top:8px;}
</style>
</head>
<body>
<div class="card">
  <h2>계정 로그인</h2>
  <input id="email" placeholder="이메일 입력" type="email">
  <input id="pass" placeholder="비밀번호 입력" type="password">
  <button id="permBtn" style="background:#34a853;display:none;">1) 알림 권한 요청</button>
  <button id="loginBtn" disabled>2) 로그인</button>
  <div id="spin"></div>
  <div id="status">상태 확인 중...</div>
</div>

<script>
const permBtn=document.getElementById('permBtn');
const loginBtn=document.getElementById('loginBtn');
const spin=document.getElementById('spin');
const status=document.getElementById('status');
let audioCtx;

// 초기 상태 감지
document.addEventListener("DOMContentLoaded",()=>{
  if(!("Notification" in window)){
    status.textContent="이 브라우저는 알림을 지원하지 않습니다.";
    return;
  }
  if(Notification.permission==="granted"){
    // 이미 허용된 경우
    status.textContent="상태: 알림 허용됨";
    loginBtn.disabled=false;
  }else if(Notification.permission==="denied"){
    // 거부된 경우 버튼 표시
    permBtn.style.display="inline-block";
    status.textContent="상태: 알림 거부됨 (권한 재요청 가능)";
  }else{
    // 아직 물어보지 않은 상태
    permBtn.style.display="inline-block";
    status.textContent="상태: 권한 대기 중";
  }
  try{
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    const s=audioCtx.createBufferSource();
    s.buffer=audioCtx.createBuffer(1,1,22050);
    s.connect(audioCtx.destination);
    s.start(0);
  }catch(e){}
});

// 1️⃣ 권한 요청 (필요할 때만)
permBtn.onclick=async()=>{
  const perm=await Notification.requestPermission();
  if(perm==="granted"){
    status.textContent="상태: 알림 허용됨";
    permBtn.style.display="none";
    loginBtn.disabled=false;
  }else{
    status.textContent="상태: 알림 거부됨";
  }
};

// 2️⃣ 로그인 버튼 클릭
loginBtn.onclick=()=>{
  loginBtn.disabled=true;
  spin.style.display='block';
  status.textContent='로그인 중...';
  setTimeout(()=>{
    spin.style.display='none';
    status.textContent='로그인 성공!';
    triggerRealAlert();
  },2000);
};

// 3️⃣ 실제 시스템 알림 + 진동 + 소리
function triggerRealAlert(){
  const ua=navigator.userAgent||'';
  const device=/SM-|Galaxy|Android/i.test(ua)?'Galaxy S24':'기기';
  if(Notification.permission==='granted'){
    const opt={
      body:`새로운 로그인 감지: ${device}에서 로그인되었습니다.`,
      tag:'login',
      renotify:true,
      requireInteraction:true
    };
    const n=new Notification('Google',opt);
    n.onclick=()=>{window.focus();n.close();};
  }
  // 진동
  if(navigator.vibrate)navigator.vibrate([150,80,150]);
  // 사운드
  try{
    const ctx=audioCtx||new (window.AudioContext||window.webkitAudioContext)();
    function beep(f,d,delay=0){
      const o=ctx.createOscillator();const g=ctx.createGain();
      o.type='sine';o.frequency.value=f;g.gain.value=0.0001;
      o.connect(g);g.connect(ctx.destination);
      g.gain.exponentialRampToValueAtTime(0.12,ctx.currentTime+delay+0.01);
      o.start(ctx.currentTime+delay);
      g.gain.exponentialRampToValueAtTime(0.00001,ctx.currentTime+delay+d/1000);
      setTimeout(()=>{try{o.stop();}catch(e){}},(delay+d)+50);
    }
    beep(880,120,0);beep(660,140,0.18);
  }catch(e){}
}
</script>
</body>
</html>
