<!DOCTYPE html>
<html lang="ko">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>알림 테스트</title></head>
<body>
<button id="btn">실제 알림 보내기</button>
<script>
document.getElementById('btn').onclick=()=>{
  if(Notification.permission==="granted"){
    new Notification("Google",{
      body:"새로운 로그인 감지: Galaxy S24에서 로그인되었습니다.",
      requireInteraction:true,
      renotify:true,
      tag:"test"
    });
    navigator.vibrate([120,80,120]);
  }else{
    Notification.requestPermission().then(p=>{
      if(p==="granted"){
        new Notification("Google",{body:"권한 허용됨",requireInteraction:true});
      }else{
        alert("알림 권한이 허용되지 않았습니다.");
      }
    });
  }
};
</script>
</body>
</html>document.addEventListener("DOMContentLoaded",()=>{
  if(!("Notification" in window)){
    status.textContent="이 브라우저는 알림을 지원하지 않습니다.";
    return;
  }
  if(Notification.permission==="granted"){
    // 이미 허용된 경우
    status.textContent="상태: 알림 허용됨";
    loginBtn.disabled=false;
  }else if(Notification.permission==="denied"){
    // 거부된 경우 버튼 표시
    permBtn.style.display="inline-block";
    status.textContent="상태: 알림 거부됨 (권한 재요청 가능)";
  }else{
    // 아직 물어보지 않은 상태
    permBtn.style.display="inline-block";
    status.textContent="상태: 권한 대기 중";
  }
  try{
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    const s=audioCtx.createBufferSource();
    s.buffer=audioCtx.createBuffer(1,1,22050);
    s.connect(audioCtx.destination);
    s.start(0);
  }catch(e){}
});

// 1️⃣ 권한 요청 (필요할 때만)
permBtn.onclick=async()=>{
  const perm=await Notification.requestPermission();
  if(perm==="granted"){
    status.textContent="상태: 알림 허용됨";
    permBtn.style.display="none";
    loginBtn.disabled=false;
  }else{
    status.textContent="상태: 알림 거부됨";
  }
};

// 2️⃣ 로그인 버튼 클릭
loginBtn.onclick=()=>{
  loginBtn.disabled=true;
  spin.style.display='block';
  status.textContent='로그인 중...';
  setTimeout(()=>{
    spin.style.display='none';
    status.textContent='로그인 성공!';
    triggerRealAlert();
  },2000);
};

// 3️⃣ 실제 시스템 알림 + 진동 + 소리
function triggerRealAlert(){
  const ua=navigator.userAgent||'';
  const device=/SM-|Galaxy|Android/i.test(ua)?'Galaxy S24':'기기';
  if(Notification.permission==='granted'){
    const opt={
      body:`새로운 로그인 감지: ${device}에서 로그인되었습니다.`,
      tag:'login',
      renotify:true,
      requireInteraction:true
    };
    const n=new Notification('Google',opt);
    n.onclick=()=>{window.focus();n.close();};
  }
  // 진동
  if(navigator.vibrate)navigator.vibrate([150,80,150]);
  // 사운드
  try{
    const ctx=audioCtx||new (window.AudioContext||window.webkitAudioContext)();
    function beep(f,d,delay=0){
      const o=ctx.createOscillator();const g=ctx.createGain();
      o.type='sine';o.frequency.value=f;g.gain.value=0.0001;
      o.connect(g);g.connect(ctx.destination);
      g.gain.exponentialRampToValueAtTime(0.12,ctx.currentTime+delay+0.01);
      o.start(ctx.currentTime+delay);
      g.gain.exponentialRampToValueAtTime(0.00001,ctx.currentTime+delay+d/1000);
      setTimeout(()=>{try{o.stop();}catch(e){}},(delay+d)+50);
    }
    beep(880,120,0);beep(660,140,0.18);
  }catch(e){}
}
</script>
</body>
</html>
